(module
  (import "js" "foo" (func $foo))
  (import "js" "init_state" (func $init_state (result f64)))
  (import "js" "compute_delta" (func $compute_delta (result f64)))
  (global $state (mut f64) (f64.const 0))
  (func $init (global.set $state (call $init_state)))
  (start $init)
  (func $get_state (export "get_state") (result f64) (global.get $state))
  (func $update_state (export "update_state") (result f64)
    (local $delta f64)
    (call $foo)
    (local.set $delta (call $compute_delta))
    (global.set $state (f64.add (global.get $state) (local.get $delta)))
    (global.get $state)
  )
)
